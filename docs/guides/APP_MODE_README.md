# App æ¨¡å¼é›¶åŸºç¡€ä¸Šæ‰‹æŒ‡å—

> è¿™ä»½æ–‡æ¡£é¢å‘**å®Œå…¨æ²¡æœ‰è‡ªåŠ¨åŒ–ç»éªŒ**çš„å°ç™½ç”¨æˆ·ã€‚ç…§ç€ä¸€æ­¥ä¸€æ­¥åšï¼Œå°±èƒ½åœ¨æ‰‹æœºä¸Šè·‘èµ·æ¥å¤§éº¦ App çš„è‡ªåŠ¨æŠ¢ç¥¨æµç¨‹ã€‚å¦‚é‡åˆ°ä»»ä½•ä¸æ–‡æ¡£ä¸ç¬¦çš„ç°è±¡ï¼Œä¼˜å…ˆæŒ‰ç…§â€œå¸¸è§é—®é¢˜ & æ•…éšœæ’æŸ¥â€éƒ¨åˆ†ä¸€æ­¥æ­¥æ£€æŸ¥ã€‚

---

## 1. å‡†å¤‡å·¥ä½œä¸€è§ˆ

| é¡¹ç›® | ç›®çš„ | æ¨èç‰ˆæœ¬ | ä¸‹è½½/æŸ¥çœ‹æ–¹å¼ |
| --- | --- | --- | --- |
| Windows 10/11 ç”µè„‘ | è¿è¡Œè„šæœ¬ä¸ Appium | \- | å·²å…·å¤‡å³å¯ |
| Android çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨ | æ‰§è¡Œå¤§éº¦ App | Android 8.0+ | çœŸæœºéœ€å¼€å¯å¼€å‘è€…æ¨¡å¼ï¼›æˆ–ä½¿ç”¨ Android Studio æ¨¡æ‹Ÿå™¨ |
| Python | è¿è¡Œé¡¹ç›®è„šæœ¬ | 3.9 ~ 3.13 | [python.org](https://www.python.org/downloads/) |
| Gitï¼ˆå¯é€‰ï¼‰ | æ‹‰å–ä»“åº“ | æœ€æ–°ç¨³å®šç‰ˆ | [git-scm.com](https://git-scm.com/) |
| Node.js | Appium ä¾èµ– | 18+ LTS | [nodejs.org](https://nodejs.org/) |
| Appium Server | é©±åŠ¨ App | 2.x | `npm install -g appium` |
| Android Platform Tools | æä¾› `adb` | æœ€æ–°ç‰ˆ | [Google Platform Tools](https://developer.android.com/tools/releases/platform-tools) |

> **æç¤º**ï¼šè‹¥ä½ ä¸ç†Ÿæ‚‰ä¸Šè¿°è½¯ä»¶çš„å®‰è£…ï¼Œå¯ä»¥å…ˆè®°å½•è½¯ä»¶åç§°ï¼Œé€ä¸ªæœç´¢â€œè½¯ä»¶å + å®‰è£…æ•™ç¨‹â€åç…§åšå³å¯ã€‚æŒ‰ç…§é¡ºåºå®Œæˆå°±å¥½ï¼Œä¸å¿…ä¸€æ¬¡æ€§å…¨éƒ¨éƒ¨ç½²ã€‚

---

## 2. ä¸€æ¬¡æ€§ç¯å¢ƒå®‰è£…æ­¥éª¤

1. **å®‰è£… Python**
    - ä¸‹è½½å®˜æ–¹å®‰è£…åŒ…æ—¶å‹¾é€‰â€œAdd Python to PATHâ€é€‰é¡¹ã€‚
    - å®‰è£…å®Œæˆåï¼Œåœ¨ PowerShell è¾“å…¥ï¼š

       ```powershell
       python --version
       ```

    - è‹¥çœ‹åˆ° `Python 3.x.x` å³è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚

2. **å®‰è£… Node.js**
    - é€‰æ‹© LTS ç‰ˆæœ¬å®‰è£…ï¼ˆåŒ…å« npmï¼‰ã€‚å®‰è£…å®Œæˆååœ¨ PowerShell è¾“å…¥ï¼š

       ```powershell
       node --version
       npm --version
       ```

3. **å®‰è£… Appium Server ä¸ Inspectorï¼ˆå¯é€‰ï¼‰**
   
    ```powershell
    npm install -g appium
    npm install -g appium-doctor
    ```

    - Appium æœåŠ¡å¯åŠ¨ï¼š

       ```powershell
       appium
       ```

    - é»˜è®¤ç›‘å¬ `http://127.0.0.1:4723/`ï¼Œçª—å£ä¿æŒæ‰“å¼€çŠ¶æ€å³å¯ã€‚
    - ä½¿ç”¨ appium-doctor æ£€æŸ¥ä¾èµ–ï¼š

       ```powershell
       appium-doctor --android
       ```

4. **å®‰è£… Android Platform Tools**
   - ä¸‹è½½å‹ç¼©åŒ…åè§£å‹ï¼Œå°† `platform-tools` æ–‡ä»¶å¤¹æ”¾åœ¨å¸¸ç”¨è·¯å¾„ï¼ˆå¦‚ `C:\Android\platform-tools`ï¼‰ã€‚
   - å°†è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒå˜é‡ `PATH`ã€‚
    - åœ¨ PowerShell è¾“å…¥ï¼š

       ```powershell
       adb version
       ```

### æ°¸ä¹…ç”Ÿæ•ˆçš„ç¯å¢ƒå˜é‡ï¼ˆè¡¥å……ï¼‰

å¦‚æœä½ å¸Œæœ›ç³»ç»Ÿçº§åˆ«æ°¸ä¹…ç”Ÿæ•ˆï¼ˆä¾¿äº Appium ä½œä¸ºæœåŠ¡æˆ–å…¶ä»–ç¨‹åºè¯»å–ï¼‰ï¼Œè¯·æŒ‰ä»¥ä¸‹è¯´æ˜è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

1. ä½¿ç”¨â€œç³»ç»Ÿå±æ€§â€ â†’ â€œé«˜çº§â€ â†’ â€œç¯å¢ƒå˜é‡â€ï¼Œåœ¨â€œç³»ç»Ÿå˜é‡â€ä¸­æ–°å¢ï¼š

   - `ANDROID_SDK_ROOT` = `C:\Android`ï¼ˆæˆ–ä½ çš„ SDK æ ¹ç›®å½•ï¼‰
   - `ANDROID_HOME` = `C:\Android`ï¼ˆå»ºè®®åŒæ—¶è®¾ç½®ä»¥å…¼å®¹æ—§å·¥å…·ï¼‰

2. åœ¨ç³»ç»Ÿå˜é‡ä¸­çš„ `Path` æ·»åŠ ï¼š`C:\Android\platform-tools`ã€‚

3. ä¿å­˜å¹¶é€€å‡ºåï¼Œè¯·é‡å¯ç”µè„‘ä»¥ç¡®ä¿æ‰€æœ‰ç³»ç»ŸæœåŠ¡å’Œæ¡Œé¢åº”ç”¨è¯»å–åˆ°æ–°çš„ç¯å¢ƒå˜é‡ã€‚

> æ³¨æ„ï¼šå°† `platform-tools` è·¯å¾„åŠ å…¥ç³»ç»Ÿ `PATH` åï¼Œå·²æœ‰è¿›ç¨‹ï¼ˆåŒ…æ‹¬ä½œä¸ºæœåŠ¡è¿è¡Œçš„ Appiumï¼‰ä¸ä¼šè‡ªåŠ¨è¯»å–åˆ°æ›´æ–°ï¼Œé‡å¯åè¿™äº›è¿›ç¨‹æ‰ä¼šçœ‹åˆ°æ–°å˜é‡ã€‚

äº¦å¯ä½¿ç”¨å‘½ä»¤è¡Œä¸ºå½“å‰ç”¨æˆ·å†™å…¥ï¼ˆéœ€é‡æ–°æ‰“å¼€ç»ˆç«¯æˆ–é‡å¯ç”Ÿæ•ˆï¼‰ï¼š

```powershell
setx ANDROID_SDK_ROOT "C:\Android"
setx ANDROID_HOME "C:\Android"
```

5. **ä¸‹è½½/å…‹éš†é¡¹ç›®**
    - ç›´æ¥ä¸‹è½½ ZIP å¹¶è§£å‹ï¼Œæˆ–ä½¿ç”¨ Gitï¼š

       ```powershell
       git clone https://github.com/10000ge10000/damai-ticket-assistant.git
       ```

6. **å®‰è£… Python ä¾èµ–**
    - åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

       ```powershell
       cd damai-ticket-assistant
       python -m pip install -r requirements.txt
       ```

---

## 3. è¿æ¥æ‰‹æœºï¼ˆæˆ–æ¨¡æ‹Ÿå™¨ï¼‰

1. **çœŸæœºå‡†å¤‡**
   - åœ¨æ‰‹æœºè®¾ç½®ä¸­ä¾æ¬¡å¼€å¯ï¼šå¼€å‘è€…æ¨¡å¼ â†’ USB è°ƒè¯• â†’ å…è®¸é€šè¿‡ USB å®‰è£… Appã€‚
   - ä½¿ç”¨åŸè£…æ•°æ®çº¿è¿æ¥ç”µè„‘ï¼Œè‹¥å¼¹å‡ºæˆæƒæç¤ºï¼Œè¯·é€‰æ‹©â€œå§‹ç»ˆå…è®¸â€ã€‚
2. **æ¨¡æ‹Ÿå™¨å‡†å¤‡**
   - Android Studio åˆ›å»ºè™šæ‹Ÿè®¾å¤‡å¹¶å¯åŠ¨ã€‚
3. **éªŒè¯è¿æ¥**
   åœ¨ PowerShell è¾“å…¥ï¼š

   ```powershell
   adb devices -l
   ```

      çœ‹åˆ°ç±»ä¼¼ `device` çŠ¶æ€ä¸”å¸¦æœ‰ `model` ä¿¡æ¯çš„è¡Œï¼Œå³è¿æ¥æˆåŠŸã€‚

---

## 4. å¯åŠ¨ Appium æœåŠ¡

ä¿æŒå¦‚ä¸‹çª—å£å¼€å¯ï¼ˆéšé¡¹ç›®å¯åŠ¨ä¸€ç›´å­˜åœ¨ï¼‰ï¼š

```powershell
appium
```

è‹¥æƒ³æŒ‡å®šç›‘å¬ç«¯å£ï¼š

```powershell
appium --address 127.0.0.1 --port 4723
```

> å°è´´å£«ï¼šApp æ¨¡å¼é»˜è®¤ä½¿ç”¨ `http://127.0.0.1:4723/wd/hub`ã€‚åªè¦ Appium æœåŠ¡å¯åŠ¨å¹¶ä¿æŒè¿è¡Œå³å¯ã€‚

---

## 5. å‡†å¤‡ config.jsoncï¼ˆæœ€ç®€æ¨¡æ¿ï¼‰

é¡¹ç›®ç›®å½•è‡ªå¸¦ `damai_appium/config.jsonc`ï¼Œæ¨èå¤åˆ¶ä¸€ä»½ä½œä¸ºå¤‡ä»½ï¼Œå†æŒ‰ä»¥ä¸‹å­—æ®µä¿®æ”¹ï¼š

```jsonc
{
  "server_url": "http://127.0.0.1:4723/wd/hub",
  "keyword": "æ¼”å‡ºå…³é”®è¯ï¼Œå¯ä¸ºç©º",
  "users": ["è§‚æ¼”äººå§“å"] ,
  "city": "åŒ—äº¬",
  "date": "2025-10-01",
  "price": "çœ‹å°",
  "price_index": 0,
  "if_commit_order": true,
  "device_caps": {
    "udid": "adb devices ä¸­çœ‹åˆ°çš„åºåˆ—å·",
    "deviceName": "è‡ªå®šä¹‰çš„è®¾å¤‡æ˜µç§°",
    "platformVersion": "å®‰å“ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ 13"
  }
}
```

### å¯é€‰ï¼šå¤šè®¾å¤‡é¡ºåºæ‰§è¡Œï¼ˆè§„åˆ’ä¸­ï¼‰

~~è¯¥åŠŸèƒ½ä»åœ¨è§„åˆ’ä¸­ï¼ŒåŸå¤šè®¾å¤‡é¡ºåºæ‰§è¡Œé…ç½®ç¤ºä¾‹æš‚ä¸é€‚ç”¨ï¼Œæ•¬è¯·æœŸå¾…åç»­æ›´æ–°ã€‚~~

---

## 6. å›¾å½¢ç•Œé¢ App æ¨¡å¼æ“ä½œæŒ‡å—

1. **å¯åŠ¨ GUI**

   ```powershell
   python start_gui.pyw
   ```
   
2. **åˆ‡æ¢è‡³â€œApp æ¨¡å¼â€æ ‡ç­¾é¡µ**
   - é¦–æ¬¡è¿›å…¥è¯·ä¾æ¬¡ç‚¹å‡»â€œç¯å¢ƒæ£€æµ‹â€â€œåˆ·æ–°è®¾å¤‡â€ï¼Œç¡®è®¤ä¾èµ–ä¸è®¾å¤‡çŠ¶æ€å‡ä¸ºç»¿è‰²ã€‚
3. **åŠ è½½é…ç½®**
   - ç‚¹å‡»â€œé€‰æ‹©é…ç½®æ–‡ä»¶â€ï¼Œæµè§ˆåˆ°å‰æ–‡ç¼–è¾‘å¥½çš„ `config.jsonc`ã€‚
   - ä¹Ÿå¯ä»¥ç›´æ¥åœ¨è¡¨å•ä¸­æ‰‹åŠ¨ä¿®æ”¹ server_urlã€è®¾å¤‡ä¿¡æ¯ã€è§‚æ¼”äººç­‰å­—æ®µã€‚
4. **æ£€æŸ¥è¿è¡Œæ—¥å¿—é¢æ¿**
   - å¦‚æœ‰å­—æ®µç¼ºå¤±ï¼Œç•Œé¢åº•éƒ¨ä¼šæç¤ºâ€œé…ç½®æ ¡éªŒå¤±è´¥â€ï¼ŒåŒæ—¶å±•ç¤ºè¯¦ç»†å­—æ®µåã€‚
5. **ç‚¹å‡»â€œå¼€å§‹æŠ¢ç¥¨â€**
   - å³ä¾§æ—¥å¿—å°†å®æ—¶è¾“å‡ºæ‰§è¡Œé˜¶æ®µï¼ˆRunnerPhaseï¼‰ï¼Œå¦‚ `CONNECTING`ã€`SELECTING_PRICE` ç­‰ã€‚
   - è‹¥éœ€ç´§æ€¥åœæ­¢ï¼Œç‚¹å‡»â€œåœæ­¢â€æŒ‰é’®å³å¯ã€‚
6. **æŸ¥çœ‹è¿è¡Œç»Ÿè®¡**
   - æŠ¢ç¥¨ç»“æŸåä¼šæ˜¾ç¤ºå°è¯•æ¬¡æ•°ã€è€—æ—¶ã€æœ€ç»ˆé˜¶æ®µç­‰ä¿¡æ¯ã€‚
   - å¦‚éœ€å¯¼å‡ºæ—¥å¿—ï¼Œç‚¹å‡»â€œå¯¼å‡ºæ—¥å¿—â€æŒ‰é’®è·å¾— JSON æ–‡ä»¶ã€‚

---

## 7. å‘½ä»¤è¡Œå¿«é€Ÿå¯åŠ¨ï¼ˆå¯ä¸ GUI å¹¶è¡Œï¼‰

### æ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œæ¨¡å—

```powershell
python -m damai_appium.damai_app_v2 --config damai_appium/config.jsonc --retries 3 --export-report run-report.json
```

å‚æ•°è¯´æ˜ï¼š

- `--config`ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶ï¼›ä¸å¡«å†™æ—¶é»˜è®¤è¯»å– `damai_appium/` ä¸‹çš„ `config.jsonc`ã€‚
- `--retries`ï¼šæœ€å¤šå°è¯•æ¬¡æ•°ï¼ˆå«é¦–æ¬¡æ‰§è¡Œï¼‰ã€‚
- `--export-report`ï¼šå¯¼å‡ºè¿è¡Œæ—¥å¿—ä¸ç»Ÿè®¡çš„ JSON æ–‡ä»¶ã€‚

### æ–¹å¼äºŒï¼šä½¿ç”¨ PowerShell å¿«é€Ÿè„šæœ¬

```powershell
pwsh ./scripts/app_mode_quickstart.ps1 -ConfigPath .\damai_appium\config.jsonc -Retries 3
```

è¯¥è„šæœ¬ä¼šè‡ªåŠ¨å®šä½ Pythonï¼Œå¯ç›´æ¥åœ¨ Windows ä¸­åŒå‡»æˆ–åœ¨ PowerShell æ‰§è¡Œã€‚

#### 8. å³å°†ä¸Šçº¿çš„ CLI ç¤ºä¾‹

- åç»­å°†æ–°å¢æ›´å®Œæ•´çš„å‘½ä»¤è¡Œå‚æ•°è®²è§£ä¸å¤šåœºæ™¯è„šæœ¬æ¨¡æ¿ï¼Œç¡®ä¿ä¸ç½‘é¡µæ¨¡å¼æŒ‡å—ä¿æŒä¸€è‡´ã€‚
- è®¡åˆ’è¡¥å……è·¨å¹³å° Shell ç¤ºä¾‹ã€å®šæ—¶ä»»åŠ¡æ¨¡æ¿ä¸ç¯å¢ƒæ£€æµ‹è„šæœ¬ï¼Œä¾¿äºæ‰¹é‡æ‰§è¡Œæˆ–æŒç»­å®ˆå€™ã€‚
- æ¬¢è¿åœ¨ Issue ä¸­æäº¤å¸Œæœ›è¦†ç›–çš„è„šæœ¬åœºæ™¯ï¼Œæˆ‘ä»¬ä¼šåœ¨æ›´æ–°æ—¶ä¼˜å…ˆè€ƒè™‘ã€‚

---

## 9. å¸¸è§é—®é¢˜ & æ•…éšœæ’æŸ¥

| ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
| --- | --- | --- |
| `server_url ä¸èƒ½ä¸ºç©º` æç¤º | é…ç½®æ–‡ä»¶æœªå¡«å†™æˆ– Appium æœªå¯åŠ¨ | ç¡®è®¤ `appium` æœåŠ¡çª—å£ä»åœ¨è¿è¡Œï¼Œå¹¶ç¡®ä¿ `server_url` å­—æ®µä»¥ `http://` å¼€å¤´ |
| `adb devices` æ²¡æœ‰è®¾å¤‡ | æ•°æ®çº¿/é©±åŠ¨é—®é¢˜ | æ¢çº¿ã€æ›´æ–° USB é©±åŠ¨ã€é‡æ–°æˆæƒ USB è°ƒè¯• |
| æ—¥å¿—åœåœ¨ `CONNECTING` é˜¶æ®µ | Appium æ— æ³•è¿æ¥åˆ°è®¾å¤‡ | æ£€æŸ¥ `device_caps.udid` æ˜¯å¦ä¸ `adb devices` è¾“å‡ºä¸€è‡´ |
| æ—¥å¿—æç¤º `NO SUCH ELEMENT` | App é¡µé¢ç»“æ„å‘ç”Ÿå˜åŒ– | å°è¯•æé«˜ `wait_timeout`ï¼Œæˆ–æ‰‹åŠ¨æ£€æŸ¥å½“å‰é¡µé¢å…ƒç´ æ˜¯å¦ä¸å¤§éº¦ App æ›´æ–°ä¿æŒä¸€è‡´ |
| CLI ç›´æ¥é€€å‡ºï¼Œè¿”å›ç  2 | é…ç½®æ ¡éªŒå¤±è´¥ | ç»ˆç«¯ä¼šåˆ—å‡ºå…·ä½“é”™è¯¯å­—æ®µï¼›æ ¹æ®æç¤ºä¿®æ”¹é…ç½®åé‡è¯• |
| éœ€è¦å¤šå°è®¾å¤‡åŒæ—¶æ‰§è¡Œ | å½“å‰ç‰ˆæœ¬ä»…æ”¯æŒ**é¡ºåºæ‰§è¡Œ**å¤šä¸ªä¼šè¯ | æ ¹æ®é…ç½®ç¤ºä¾‹æ·»åŠ  `devices` æ•°ç»„ï¼Œæ¯å°è®¾å¤‡ä¼šä¾æ¬¡è¿è¡Œ |

---

## 10. æå‡æˆåŠŸç‡çš„å°æŠ€å·§

- æå‰ç™»å½•å¤§éº¦ Appï¼Œå¹¶åœ¨â€œå…¨éƒ¨è®¢å•â€é‡Œç¡®è®¤èº«ä»½ä¿¡æ¯æ— è¯¯ã€‚
- ä½¿ç”¨æœ‰çº¿ç½‘ç»œæˆ–ç¨³å®šçš„ Wi-Fiï¼Œé¿å…æŠ¢ç¥¨è¿‡ç¨‹æ‰çº¿ã€‚
- æå‰æ‰“å¼€ App å¹¶è¿›å…¥ç›®æ ‡æ¼”å‡ºé¡µé¢ï¼Œå¯ç¼©çŸ­è‡ªåŠ¨åŒ–æµç¨‹çš„åŠ è½½æ—¶é—´ã€‚
- å¯¹åŒä¸€åœºæ¬¡ï¼Œå¯è®¾ç½®å¤šå°è®¾å¤‡é¡ºåºå°è¯•ï¼Œä»¥æé«˜å‘½ä¸­ç‡ã€‚

---

## 11. ä½ å·²ç»å®Œæˆäº†ä»€ä¹ˆ

- æ­å»ºå®Œæ•´çš„ Appium + Python æŠ¢ç¥¨ç¯å¢ƒã€‚
- èƒ½å¤Ÿåœ¨ GUI ä¸­åŠ è½½é…ç½®ã€æ£€æµ‹ä¾èµ–ã€æŸ¥çœ‹æ—¥å¿—ä¸ç»Ÿè®¡ã€‚
- å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæˆ–è„šæœ¬æ‰¹é‡æ‰§è¡Œï¼Œå¹¶è·å¾—è¯¦ç»†çš„è¿è¡ŒæŠ¥å‘Šã€‚

å¦‚éœ€æ‰©å±•æ›´å¤šé«˜çº§åŠŸèƒ½ï¼ˆå¦‚å®šæ—¶ä»»åŠ¡ã€è¿œç¨‹è°ƒåº¦ã€è‡ªå®šä¹‰è„šæœ¬ï¼‰ï¼Œæ¬¢è¿ç»§ç»­å…³æ³¨ä»“åº“åç»­æ›´æ–°æˆ–å‚ä¸è´¡çŒ®ã€‚

ç¥ä½ æŠ¢ç¥¨é¡ºåˆ©ï¼ğŸ«

## 12. å®šæ—¶æŠ¢ç¥¨ï¼ˆApp æ¨¡å¼ï¼‰

> æœ¬èŠ‚ä»‹ç»å¦‚ä½•åœ¨ App æ¨¡å¼ä¸‹æŒ‰æŒ‡å®šæ—¶é—´è‡ªåŠ¨å¼€æŠ¢ï¼ŒåŸºäºå·²æä¾›çš„ CLI å…¥å£ä¸æ–°å¢å‚æ•°ï¼Œæ— éœ€ä¿®æ”¹ GUIã€‚

### åŠŸèƒ½æ¦‚è¿°

- åœ¨å‘½ä»¤è¡Œå…¥å£äºåˆ°ç‚¹æ—¶è‡ªåŠ¨å¼€å§‹æ‰§è¡ŒæŠ¢ç¥¨æµç¨‹ï¼Œæ”¯æŒåˆ°ç‚¹å‰é¢„çƒ­æ£€æŸ¥ï¼ˆAppium /status ä¸ adb è®¾å¤‡çŠ¶æ€ï¼‰ã€‚
- å®ç°ä½ç½®ï¼šå…¥å£é€»è¾‘ä¸å‚æ•°è§£æåœ¨ [damai_appium/damai_app_v2.py](damai_appium/damai_app_v2.py:133)ï¼Œæ–°å¢å‚æ•°è§£æè§ [_parse_args()](damai_appium/damai_app_v2.py:56)ã€‚

### å‚æ•°è¯´æ˜

- `--start-at`ï¼šå®šæ—¶å¼€æŠ¢æ—¶é—´
  - æ”¯æŒ ISO8601ï¼šå¦‚ `2025-10-01T20:00:00+08:00`ã€`2025-10-01T12:00:00Z`
  - æ”¯æŒæœ¬åœ°æ—¶åŒºæ ¼å¼ï¼š`'YYYY-MM-DD HH:MM:SS'`ï¼ˆæŒ‰æœ¬åœ°æ—¶åŒºè§£æï¼‰
- `--warmup-sec`ï¼šåˆ°ç‚¹å‰é¢„çƒ­æ£€æŸ¥çª—å£ï¼ˆç§’ï¼‰
  - åœ¨åˆ°ç‚¹å‰è¿›å…¥è¯¥çª—å£æ—¶ï¼Œä¼šå¿«é€Ÿæ£€æŸ¥ Appium `/status` ä¸ `adb devices -l` æ˜¯å¦ä¸º `device` çŠ¶æ€
- å…¶å®ƒå¸¸ç”¨å‚æ•°
  - `--config`ï¼šé…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤è¯»å– `damai_appium/config.jsonc`ï¼‰
  - `--retries`ï¼šæœ€å¤§å°è¯•æ¬¡æ•°ï¼ˆåŒ…å«é¦–æ¬¡æ‰§è¡Œï¼‰
  - `--export-report`ï¼šå¯¼å‡ºæœ¬æ¬¡è¿è¡Œçš„ JSON æŠ¥å‘Šï¼Œæ–¹ä¾¿å¤ç›˜

### ä½¿ç”¨ç¤ºä¾‹ï¼ˆå‘½ä»¤è¡Œï¼‰

- æœ¬åœ°æ—¶åŒºæ ¼å¼ï¼ˆé¦™æ¸¯/UTC+8ï¼‰
  ```powershell
  python -m damai_appium.damai_app_v2 `
    --config damai_appium/config.jsonc `
    --retries 6 `
    --start-at "2025-10-01 20:00:00" `
    --warmup-sec 120 `
    --export-report run-report.json
  ```
- ISO8601ï¼ˆæ˜¾å¼æ—¶åŒºï¼‰
  ```powershell
  python -m damai_appium.damai_app_v2 `
    --config damai_appium/config.jsonc `
    --retries 6 `
    --start-at 2025-10-01T20:00:00+08:00 `
    --warmup-sec 120 `
    --export-report run-report.json
  ```

### ä½¿ç”¨ç¤ºä¾‹ï¼ˆPowerShell å¿«é€Ÿè„šæœ¬ï¼‰

- è„šæœ¬ä½ç½®ä¸æ‰©å±•å‚æ•°ï¼šæ”¯æŒ `-StartAt` ä¸ `-WarmupSec` å°è£…è°ƒç”¨ [scripts/app_mode_quickstart.ps1](scripts/app_mode_quickstart.ps1:1)
  ```powershell
  pwsh ./scripts/app_mode_quickstart.ps1 `
    -ConfigPath .\damai_appium\config.jsonc `
    -Retries 6 `
    -StartAt "2025-10-01 20:00:00" `
    -WarmupSec 120
  ```

### Windows ä»»åŠ¡è®¡åˆ’ç¨‹åºï¼ˆTask Schedulerï¼‰ç¤ºä¾‹æ­¥éª¤

1. æ‰“å¼€â€œä»»åŠ¡è®¡åˆ’ç¨‹åºâ€ â†’ â€œåˆ›å»ºä»»åŠ¡â€ã€‚
2. è§¦å‘å™¨ï¼šé€‰æ‹©å…·ä½“æ—¥æœŸä¸æ—¶é—´ï¼ˆå»ºè®®æå‰ç¡®ä¿ç³»ç»Ÿæ—¶é—´åŒæ­¥ï¼‰ã€‚
3. æ“ä½œï¼š
   - Program/script: `python`
   - Arguments: `-m damai_appium.damai_app_v2 --config "C:\path\damai_appium\config.jsonc" --retries 6 --start-at "2025-10-01 20:00:00" --warmup-sec 120 --export-report "C:\logs\run-report.json"`
   - Start in: é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¾‹å¦‚ `C:\path\to\damai-ticket-assistant`ï¼‰
   - æˆ–ä½¿ç”¨ PowerShell è„šæœ¬ï¼šProgram/script `pwsh`ï¼ŒArguments `-File "C:\path\to\scripts\app_mode_quickstart.ps1" -ConfigPath "C:\path\damai_appium\config.jsonc" -Retries 6 -StartAt "2025-10-01 20:00:00" -WarmupSec 120`
4. æ¡ä»¶ä¸è®¾ç½®ï¼šå‹¾é€‰â€œå…è®¸æŒ‰éœ€è¿è¡Œâ€ä¸â€œå³ä½¿ç”¨æˆ·æœªç™»å½•ä¹Ÿè¿è¡Œâ€ï¼ˆæŒ‰éœ€é€‰æ‹©ï¼‰ï¼›å»ºè®®å¼€å¯â€œä»¥æœ€é«˜æƒé™è¿è¡Œâ€ï¼ˆé¿å…ç¯å¢ƒæƒé™é—®é¢˜ï¼‰ã€‚

### å‚æ•°æ­é…å»ºè®®

- å¼€å”®å†²åˆºï¼š`--retries 5~6`ã€`--warmup-sec 60~180`ï¼›é…ç½®ä¸­ `wait_timeoutâ‰ˆ1.4~1.6`ã€`retry_delayâ‰ˆ1.0~1.2`ã€`price_index` ç²¾å‡†ã€‚
- å®ˆå€™å›æµï¼š`--retries 8~10`ã€`--warmup-sec 120~300`ï¼›é…ç½®ä¸­ `wait_timeoutâ‰ˆ1.8~2.2`ã€`retry_delayâ‰ˆ1.5`ã€‚

### å‰ç½®æ¡ä»¶ä¸å¥åº·æ£€æŸ¥

- Appium Server å»ºè®®æå‰å¸¸é©»ï¼ˆå¦‚ `appium --address 127.0.0.1 --port 4723 --relaxed-security`ï¼‰ï¼Œé¿å…åˆ°ç‚¹å¯åŠ¨å¼•å…¥æŠ–åŠ¨ï¼ˆè¯´æ˜è§ [damai_appium/app.md](damai_appium/app.md:4)ï¼‰ã€‚
- `adb devices -l` è¾“å‡ºé¡»ä¸º `device` çŠ¶æ€ï¼ˆè§£æèƒ½åŠ›åœ¨ [damai_appium/config.py](damai_appium/config.py:361)ï¼‰ï¼›è®¾å¤‡éœ€å¼€å¯å¼€å‘è€…æ¨¡å¼ã€USB è°ƒè¯•â€œå§‹ç»ˆå…è®¸â€ã€‚

### æŠ¥å‘Šä¸å¤ç›˜

- ä½¿ç”¨ `--export-report` å¯¼å‡º JSONï¼ˆåŒ…å«æœ€ç»ˆé˜¶æ®µã€å°è¯•æ¬¡æ•°ã€å¤±è´¥ç ä¸è€—æ—¶ï¼‰ï¼Œå¯¼å‡ºé€»è¾‘è§ [_export_reports()](damai_appium/damai_app_v2.py:104) ä¸è¿è¡ŒæŒ‡æ ‡æ¥æº [DamaiAppTicketRunner.run()](damai_appium/runner.py:199)ã€‚
- æ ¹æ®æŠ¥å‘Šä¸­çš„ `final_phase` ä¸ `failure_code` è°ƒå‚ï¼ˆä¾‹å¦‚å¢å¤§ `--retries`ã€å¾®è°ƒ `wait_timeout`/`retry_delay`ã€ä¿®æ­£ `price_index`ï¼‰ï¼Œæå‡å‘½ä¸­ç‡ä¸ç¨³å®šæ€§ã€‚

## â° å®šæ—¶æŠ¢ç¥¨ï¼ˆApp æ¨¡å¼ï¼‰

- åŠŸèƒ½æ¦‚è¿°ï¼šåœ¨ CLI å…¥å£åˆ°è¾¾æŒ‡å®šæ—¶é—´ç‚¹æ—¶è‡ªåŠ¨å¼€å§‹ App æ¨¡å¼æŠ¢ç¥¨æµç¨‹ï¼Œæ”¯æŒåˆ°ç‚¹å‰é¢„çƒ­æ£€æŸ¥ï¼ˆAppium /status ä¸ adb è®¾å¤‡çŠ¶æ€ï¼‰ã€‚
- å®ç°ä½ç½®ä¸å…¥å£å‚è€ƒï¼š[main()](damai_appium/damai_app_v2.py:133)ã€å‚æ•°è§£æ [_parse_args()](damai_appium/damai_app_v2.py:56)

å‚æ•°å¯¹ç…§è¡¨
| åºå· | å‚æ•°å | è¯´æ˜ | ç¤ºä¾‹å€¼ | é»˜è®¤å€¼ |
|---|---|---|---|---|
| 1 | --start-at | å®šæ—¶å¼€æŠ¢æ—¶é—´ï¼Œæ”¯æŒ ISO8601ï¼ˆå«æ—¶åŒºï¼‰æˆ–æœ¬åœ°æ—¶åŒºçš„â€œYYYY-MM-DD HH:MM:SSâ€ | 2025-10-01T20:00:00+08:00ï¼›"2025-10-01 20:00:00" | æœªè®¾ç½®ï¼ˆç«‹å³æ‰§è¡Œï¼‰ |
| 2 | --warmup-sec | åˆ°ç‚¹å‰é¢„çƒ­æ£€æŸ¥çª—å£ï¼ˆç§’ï¼‰ï¼Œåœ¨çª—å£å†…æ£€æŸ¥ Appium æœåŠ¡ä¸ adb è®¾å¤‡çŠ¶æ€ | 120 | 0ï¼ˆä¸å¯ç”¨ï¼‰ |
| 3 | --config | é…ç½®æ–‡ä»¶è·¯å¾„ | damai_appium/config.jsonc | é»˜è®¤è¯»å– damai_appium/config.jsonc |
| 4 | --retries | æœ€å¤§å°è¯•æ¬¡æ•°ï¼ˆåŒ…å«é¦–æ¬¡ï¼‰ | 6 | 3 |
| 5 | --export-report | å¯¼å‡ºè¿è¡ŒæŠ¥å‘Šåˆ° JSON æ–‡ä»¶ | run-report.json | æœªè®¾ç½®ï¼ˆä¸å¯¼å‡ºï¼‰ |

ä½¿ç”¨ç¤ºä¾‹ï¼ˆå‘½ä»¤è¡Œï¼‰
- æœ¬åœ°æ—¶åŒºæ ¼å¼ï¼ˆé¦™æ¸¯/UTC+8ï¼‰
  - python -m damai_appium.damai_app_v2 --config damai_appium/config.jsonc --retries 6 --start-at "2025-10-01 20:00:00" --warmup-sec 120 --export-report run-report.json
- ISO8601ï¼ˆæ˜¾å¼æ—¶åŒºï¼‰
  - python -m damai_appium.damai_app_v2 --config damai_appium/config.jsonc --retries 6 --start-at 2025-10-01T20:00:00+08:00 --warmup-sec 120 --export-report run-report.json

ä½¿ç”¨ç¤ºä¾‹ï¼ˆPowerShell å¿«é€Ÿè„šæœ¬ï¼‰
- å·²æ”¯æŒ `-StartAt` ä¸ `-WarmupSec` å‚æ•°ï¼Œç”¨äºå°è£…å‘½ä»¤è¡Œè°ƒç”¨ï¼š
  - pwsh ./scripts/app_mode_quickstart.ps1 -ConfigPath .\damai_appium\config.jsonc -Retries 6 -StartAt "2025-10-01 20:00:00" -WarmupSec 120
- è„šæœ¬ä½ç½®ï¼š[scripts/app_mode_quickstart.ps1](scripts/app_mode_quickstart.ps1:1)

è½åœ°å»ºè®®ï¼ˆWindows ä»»åŠ¡è®¡åˆ’ç¨‹åºï¼‰
- Program/script: python
- Arguments: -m damai_appium.damai_app_v2 --config "C:\path\damai_appium\config.jsonc" --retries 6 --start-at "2025-10-01 20:00:00" --warmup-sec 120 --export-report "C:\logs\run-report.json"
- Start in: é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¾‹å¦‚ C:\path\to\damai-ticket-assistantï¼‰
- æˆ–ä½¿ç”¨ PowerShell è„šæœ¬ï¼šProgram/script: pwshï¼›Arguments: -File "C:\path\to\scripts\app_mode_quickstart.ps1" -ConfigPath "C:\path\damai_appium\config.jsonc" -Retries 6 -StartAt "2025-10-01 20:00:00" -WarmupSec 120

å‚æ•°æ­é…å»ºè®®
- å¼€å”®å†²åˆºï¼š--retries 5~6ï¼›--warmup-sec 60~180ï¼›é…ç½®ä¸­ wait_timeoutâ‰ˆ1.4~1.6ã€retry_delayâ‰ˆ1.0~1.2ã€price_index ç²¾å‡†ã€‚
- å®ˆå€™å›æµï¼š--retries 8~10ï¼›--warmup-sec 120~300ï¼›é…ç½®ä¸­ wait_timeoutâ‰ˆ1.8~2.2ã€retry_delayâ‰ˆ1.5ã€‚

å‰ç½®æ¡ä»¶ä¸å¥åº·æ£€æŸ¥
- Appium Server å»ºè®®æå‰å¸¸é©»ï¼ˆå¦‚ appium --address 127.0.0.1 --port 4723 --relaxed-securityï¼‰ï¼Œé¿å…åˆ°ç‚¹å¯åŠ¨å¼•å…¥æŠ–åŠ¨ï¼Œè¯´æ˜è¯¦è§ [å®‰å“ç«¯V2ç‰ˆæœ¬ä»‹ç»](damai_appium/app.md:4)ã€‚
- adb devices -l è¾“å‡ºé¡»ä¸º device çŠ¶æ€ï¼ˆè§£æèƒ½åŠ›åœ¨ [parse_adb_devices()](damai_appium/config.py:361)ï¼‰ï¼Œè®¾å¤‡éœ€å¼€å¯å¼€å‘è€…æ¨¡å¼ä¸ USB è°ƒè¯•â€œå§‹ç»ˆå…è®¸â€ã€‚

æŠ¥å‘Šä¸å¤ç›˜
- ä½¿ç”¨ --export-report å¯¼å‡º JSONï¼ˆåŒ…å«æœ€ç»ˆé˜¶æ®µã€å°è¯•æ¬¡æ•°ã€å¤±è´¥ç ä¸è€—æ—¶ï¼‰ï¼Œå¯¼å‡ºé€»è¾‘è§ [_export_reports()](damai_appium/damai_app_v2.py:104)ï¼Œè¿è¡ŒæŒ‡æ ‡æ¥æº [DamaiAppTicketRunner.run()](damai_appium/runner.py:199)ã€‚
- æ ¹æ®æŠ¥å‘Šä¸­çš„ final_phase ä¸ failure_code è°ƒå‚ï¼ˆå¢å¤§ --retriesã€å¾®è°ƒ wait_timeout/retry_delayã€ä¿®æ­£ price_indexï¼‰ï¼Œæå‡å‘½ä¸­ç‡ä¸ç¨³å®šæ€§ã€‚
